---
import Layout from '../layouts/Layout.astro'

import { profile } from '@/settings'
import { publications } from '@/data/cv'
import { getCollection } from 'astro:content'

import ProfilePictures from '@/assets/profile_pictures.jpg'
import ProfilePic2 from '@/assets/profile_pic2.jpg'
import PixelProfilePic from '@/assets/pixel-portrait.png'
import HeroBlog from '@/components/ui/HeroBlog.astro'
// import Grid from '@/components/ui/Grid.astro'
import ArticleList from '@/components/ui/ArticleList.astro'
import BlogPostList from '@/components/ui/BlogPostList.astro'

import HeroLatestPost from '@/components/ui/HeroLatestPost.astro'
import { template } from '@/settings'

const { fullName, blogName, title, institute, research_areas } = profile

const blogEntries = await getCollection("blog");

const posts = blogEntries
  .filter((post) => !post.data.draft) // optional: hide drafts on homepage
  .sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime());

const latest = posts[0];

const latestPost = latest
  ? {
      title: latest.data.title,
      date: latest.data.date,
      description: latest.data.description,
      href: `${template.base}/blog/${latest.id}`,
      // Optional image field if you have it in frontmatter; otherwise fallback
      image: (latest.data.image ?? PixelProfilePic) as any,
    }
  : null;


---

<Layout>
	<!-- Hero Section -->
	<section class='flex items-center gap-12 no-border pb-12'>
		<HeroBlog
			fullName={fullName}
			blogName={blogName}
			title={title}
			institute={institute}
			profilePicture={ProfilePictures}
			profilePicture2={ProfilePic2}
			pixelProfilePic={PixelProfilePic}
		/>
	</section>

	<!-- Research Areas 
	<section class='py-12 border-b'>
		<Grid gridTitle='Research Areas' gridItems={research_areas} />
	</section> -->

	<!-- Recent Publications 
	<section class='py-12 border-t'>
		<ArticleList listTitle='Recent Publications' listItems={publications} />
	</section> -->

	<!-- Recent Publications 
	<section class='py-12 no-border'>
		<BlogPostList listTitle='Latest Updates' />
		<p class="text-center">
			<a href="/blog/1" class="btn btn-secondary mt-6">View All Posts</a>
		</p>
	</section>
	-->
	{latestPost && (
  <section class="no-border pb-8">
    <HeroLatestPost
      title={latestPost.title}
      date={latestPost.date}
      description={latestPost.description}
      href={latestPost.href}
      image={latestPost.image}
    />
  </section>
)}

<section class="no-border pb-12 margin-top-12 align-center">
	
  <p class="text-center">
    <a href={`${template.base}/blog/1`} class="btn btn-primary btn-lg">
      Browse all posts
    </a>
  </p>
</section>

</Layout>
